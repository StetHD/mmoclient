package game{	import flash.utils.Dictionary;	import game.entity.City;	import game.perception.PerceptionManager;	import game.Kingdom;	import net.packet.InfoKingdom;	import game.entity.Entity;	import net.packet.RecipePacket;	import net.packet.UnitRecipe;	import stats.ItemRecipe;	import stats.UnitRecipe;		public class KingdomManager	{		public static var INSTANCE:KingdomManager = new KingdomManager();					private var kingdoms:Array;				public function KingdomManager()		{			kingdoms = new Array();		}				public function getKingdomByCity(cityId:int) : Kingdom		{			var entity:Entity = PerceptionManager.INSTANCE.getEntity(cityId);						if(entity != null)			{				return KingdomManager.INSTANCE.getKingdom(entity.playerId);			}						return null;		}				public function getKingdom(playerId:int) : Kingdom		{			trace("KingdomManager: " + kingdoms.length);			for(var i:int = 0; i < kingdoms.length; i++)			{				var kingdom:Kingdom = Kingdom(kingdoms[i]);								if(kingdom.playerId == playerId)				{					return kingdom;				}			}						return null;		}				public function addKingdom(playerId:int, infoKingdom:InfoKingdom) : void		{			var kingdom:Kingdom = new Kingdom();						kingdom.id = infoKingdom.id;			kingdom.playerId = playerId;			kingdom.name = infoKingdom.name;			kingdom.gold = infoKingdom.gold;			kingdom.itemRecipes = new Array();			kingdom.unitRecipes = new Array();						for(var i:int = 0; i < infoKingdom.itemRecipes.length; i++)			{				var itemRecipe:ItemRecipe = new ItemRecipe();								itemRecipe.typeId = RecipePacket(infoKingdom.itemRecipes[i]).typeId;				itemRecipe.templateId = RecipePacket(infoKingdom.itemRecipes[i]).templateId;				itemRecipe.playerId = RecipePacket(infoKingdom.itemRecipes[i]).playerId;				itemRecipe.itemName = RecipePacket(infoKingdom.itemRecipes[i]).itemName;				itemRecipe.flavourText = RecipePacket(infoKingdom.itemRecipes[i]).flavourText;				itemRecipe.materialType = RecipePacket(infoKingdom.itemRecipes[i]).materialType;								Stats.INSTANCE.addItemRecipe(itemRecipe);								kingdom.itemRecipes.push(itemRecipe);			}						for(var i:int = 0; i < infoKingdom.unitRecipes.length; i++)			{				var unitRecipe:stats.UnitRecipe = new stats.UnitRecipe();								unitRecipe.typeId = net.packet.UnitRecipe(infoKingdom.unitRecipes[i]).typeId;				unitRecipe.templateId = net.packet.UnitRecipe(infoKingdom.unitRecipes[i]).templateId;				unitRecipe.playerId = net.packet.UnitRecipe(infoKingdom.unitRecipes[i]).playerId;				unitRecipe.unitName = net.packet.UnitRecipe(infoKingdom.unitRecipes[i]).unitName;				unitRecipe.defaultSize = net.packet.UnitRecipe(infoKingdom.unitRecipes[i]).defaultSize;				unitRecipe.gear = net.packet.UnitRecipe(infoKingdom.unitRecipes[i]).gear;								Stats.INSTANCE.addUnitRecipe(unitRecipe);								kingdom.unitRecipes.push(unitRecipe);			}						removePreviousKingdom(kingdom);						kingdoms.push(kingdom);		}				private function removePreviousKingdom(kingdom:Kingdom) : void		{			for(var i:int = 0; i < kingdoms.length; i++)			{				var previousKingdom:Kingdom = Kingdom(kingdoms[i]);								if(kingdom.id = previousKingdom.id)				{					kingdoms.splice(i, 1);					break;				}			}		}	}}