package ui {		import flash.display.MovieClip;	import fl.text.TLFTextField;	import game.entity.City;	import game.Kingdom;	import game.KingdomManager;	import game.entity.Army;	import flash.events.MouseEvent;	import game.Game;	import ui.events.GameEvents;			public class ArmyOverviewUI extends MovieClip 	{		public static const ENTRY_X:int = 6;		public static const ENTRY_Y:int = 60;						public var cityName:TLFTextField;		public var formNew:MovieClip;		public var formNewPopup:FormNewPopup;		public var disbandPopup:DisbandPopup;		public var disableLayer:MovieClip;		public var entryLayer:MovieClip;				public var pagination:Pagination;				public var createButton:ContractButton;		public var disbandButton:ContractButton;		public var closeButton:CloseButton;				public var city:City;				private var entries:Array;		private var selectedEntry:ArmyEntry;				public function ArmyOverviewUI() 		{			entries = new Array();						formNewPopup.visible = false;			disbandPopup.visible = false;			disableLayer.visible = false;						formNew.addEventListener(MouseEvent.CLICK, formNewClick);						formNewPopup.confirmButton.addEventListener(MouseEvent.CLICK, formConfirmClick);			formNewPopup.cancelButton.addEventListener(MouseEvent.CLICK, formCancelClick);						disbandPopup.confirmButton.addEventListener(MouseEvent.CLICK, disbandConfirmClick);			disbandPopup.cancelButton.addEventListener(MouseEvent.CLICK, disbandCancelClick);						createButton.buttonName.text = "Form";			disbandButton.buttonName.text = "Disband";						createButton.addEventListener(MouseEvent.CLICK, formNewClick);			disbandButton.addEventListener(MouseEvent.CLICK, disbandClick);						closeButton.addEventListener(MouseEvent.CLICK, closeButtonClick);		}				public function showPanel() : void		{			trace("ArmyOverviewUI - showPanel");			this.visible = true;					}				public function updatePanel() : void		{			resetPanel();			setArmies();			}				private function resetPanel() : void		{			formNewPopup.visible = false;			disbandPopup.visible = false;			disableLayer.visible = false;					}				private function setArmies() : void		{			trace("ArmyOverviewUI - city: " + city);			var kingdom:Kingdom = KingdomManager.INSTANCE.getKingdom(city.playerId);			var armies:Array = kingdom.getArmies();						for(var i:int = 0; i < armies.length; i++)			{				var army:Army = Army(armies[i]);				var entry:ArmyEntry = new ArmyEntry();								entry.armyId = army.id;				entry.armyName.text = army.armyName;				entry.armySize.text = army.getNumSoldiers().toString();				entry.armyAction.text = army.state.toString();				entry.x = ENTRY_X;				entry.y = ENTRY_Y + i * (entry.height + 2);				entry.addEventListener(MouseEvent.CLICK, entryClick);								entry.mouseChildren = false;								entry.setImage(army.getImage());								entries.push(entry);								entryLayer.addChild(entry);			}		}				private function entryClick(e:MouseEvent) : void		{			selectedEntry = ArmyEntry(e.currentTarget);		}				private function formNewClick(e:MouseEvent) : void		{			formNewPopup.parent.setChildIndex(formNewPopup, formNewPopup.parent.numChildren - 1);						disableLayer.visible = true;			formNewPopup.visible = true;			formNewPopup.cityName.text = city.cityName;		}				private function disbandClick(e:MouseEvent) : void		{			disbandPopup.parent.setChildIndex(disbandPopup, disbandPopup.parent.numChildren - 1);						disableLayer.visible = true;			disbandPopup.visible = true;			disbandPopup.cityName.text = city.cityName;						if(selectedEntry != null)			{				disbandPopup.armyName.text = selectedEntry.armyName.text;			}		}				private function disbandConfirmClick(e:MouseEvent) : void		{			trace("disbandConfirmClick");		}				private function disbandCancelClick(e:MouseEvent) : void		{			disbandPopup.visible = false;			disableLayer.visible = false;		}				private function formConfirmClick(e:MouseEvent) : void		{			trace("formConfirmClick");			var parameters:Object = {cityId: city.id,									 armyName: formNewPopup.armyName.text};						var pEvent:ParamEvent = new ParamEvent(Game.cityFormArmyEvent);			pEvent.params = parameters;							Game.INSTANCE.dispatchEvent(pEvent);							}				private function formCancelClick(e:MouseEvent) : void		{			formNewPopup.visible = false;			disableLayer.visible = false;		}				private function closeButtonClick(e:MouseEvent) : void		{			this.visible = false;		}	}	}